<app-module-nav>
	<title-bar
		css="ui-primary shadow-bar title-bar-fixed"
		title="{ title }"
		iconbar="{ sideBarIsExpanded }"
		mdicon="{ mdicon }">
	</title-bar>
	<div class="title-bar-spacer"></div>
	<ui-auth-spinner css="{ spinner  ? 'show' : 'hide' }" ></ui-auth-spinner>
	<div class="f-row" style="min-height:calc(100vh - 7em);">
		<div class="side-bar { expanded:sideBarIsExpanded, contracted:!sideBarIsExpanded }">
			<div class="icon-bar fg-grey-lt pad-dot-5">
				<virtual each="{ iconBarItems }">
					<nav-bar-icon
						css="{
							fg-primary:name == title,
							noshadow:name == title
						}"
						mdicon="{ mdicon }"
						onclick="{ iconBarClick }">
					</nav-bar-icon>
				</virtual>
			</div>
		</div>
		<div id="moduleNavMount" class="container-flex-1280 ui-white shadow"></div>
	</div>
	<style>
		.active-icon {
			width:2.5em;
			height:2.5em;
			border-radius:50%;
		}
		.title-bar-fixed { position:fixed;width:100%; }
		.title-bar-spacer { height:3.5em; }
		.side-bar { flex:0; }
		.expanded { flex:0 0 3.5em;height:calc(100vh - 7em);overflow:auto; }
		.contracted { height:0;width:0;overflow:hidden; }
		.expanded .icon-bar {
			position:fixed;
			height:calc(100vh - 7em);
			overflow:auto;
		}
		.side-bar.contracted .icon-bar { width:0;height:0; }
		.container-flex-1280 {
			flex:1;
			margin-left:0;
			margin-right:0;
			min-height:100%;
			overflow-y:auto;
		}
		@media only screen and (min-width:992px) {
			.container-flex-1280 {
				flex:1;
				/*max-width:1280px;*/
				margin-left:auto;
				margin-right:auto;
			}
		}
	</style>
	<script>
		var self = this;
		iconBarItems = navMenuItems;
		iconBarClick = function(e) {
			if (e.item.route == '/login') {
				RC.trigger('AM_SIGN_OUT');
			}else {
				route(e.item.route);
			}
		}
		siedBarIsExpanded = false;
		// ----------------------------------------
		// UPDATE TEMPLATE STATE
		// ----------------------------------------
		updateTemplateState = function(newState) {
			if (newState) {
				var updates = {
					mdicon:newState.mdicon,
					sideBarIsExpanded:newState.iconBar,
					title:newState.title,
				}
				self.update(updates);
			}
		};
		// ----------------------------------------
		// ON UI STATE CHANGE
		// ----------------------------------------
		RC.on('UI_STATE_CHANGED',function(state) {
			if (state) {
				updateTemplateState(state);
				spinner = state.spinner;
			}
		});
		// ----------------------------------------
		// ON MOUNT
		// ----------------------------------------
		this.one('mount',function() {
			var newState = {
				mdicon:"mdi mdi-refresh",
				title:"Initializing...",
			};
			updateTemplateState(newState);
			RC.trigger('UI_SET_STATE',newState);
		});
	</script>
</app-module-nav>
